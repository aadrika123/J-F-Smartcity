import{_ as T,c as E,j as e,P as X}from"./index-IwqKwRs2.js";import{r as K,h as Y,d as S}from"./router-WshRxXk2.js";import{u as Z,F as ee,S as U,T as r,L as ae}from"./TextArea-Ad78nHyl.js";import{r as m}from"./tailwind-Ucrx0-S6.js";import{c as ie,a as d}from"./index.esm-Wdru5IDi.js";import{a as te,b as $}from"./useCustomQuery-zBssyFpw.js";import{u as oe}from"./useErrorFocusField-RmJb-2tU.js";import{r as se}from"./resizeImage-YqNI2yf8.js";import{C as ne,O as le}from"./CreateConfirmation-AcTbvfNi.js";import"./reactQuery-2daanlHr.js";import"./reactQueryDevtools-6dm9iask.js";import"./axios-YpSsR79r.js";import"./reactIcons-UnuJhE_7.js";import"./reactLazyLoadImageComponent-2lnvQYCj.js";import"./headlessui-oHdMYZDI.js";import"./isObject-p2Uu8wxa.js";var z={};Object.defineProperty(z,"__esModule",{value:!0});var Q=z.useGeolocated=void 0;const s=K;function re(v={}){const{positionOptions:p={enableHighAccuracy:!0,maximumAge:0,timeout:1/0},isOptimisticGeolocationEnabled:x=!0,userDecisionTimeout:h=void 0,suppressLocationOnMount:C=!1,watchPosition:n=!1,geolocationProvider:l=typeof navigator<"u"?navigator.geolocation:void 0,watchLocationPermissionChange:b=!1,onError:f,onSuccess:j}=v,a=(0,s.useRef)(0),I=(0,s.useRef)(!0),w=(0,s.useRef)(0),[H,D]=(0,s.useState)(x),[c,G]=(0,s.useState)(),[A,M]=(0,s.useState)(),[O,L]=(0,s.useState)(),[B,W]=(0,s.useState)(),u=(0,s.useCallback)(()=>{a.current&&window.clearTimeout(a.current)},[]),g=(0,s.useCallback)(t=>{u(),I.current&&(G(()=>{}),D(!1),L(t)),f==null||f(t)},[f,u]),y=(0,s.useCallback)(t=>{u(),I.current&&(G(t.coords),M(t.timestamp),D(!0),L(()=>{})),j==null||j(t)},[j,u]),P=(0,s.useCallback)(()=>{if(!l||!l.getCurrentPosition||!l.watchPosition)throw new Error("The provided geolocation provider is invalid");h&&(a.current=window.setTimeout(()=>{g()},h)),n?w.current=l.watchPosition(y,g,p):l.getCurrentPosition(y,g,p)},[l,n,h,g,y,p]);return(0,s.useEffect)(()=>{let t;return b&&l&&"permissions"in navigator&&navigator.permissions.query({name:"geolocation"}).then(N=>{t=N,t.onchange=()=>{W(t.state)}}).catch(N=>{console.error("Error updating the permissions",N)}),()=>{t&&(t.onchange=null)}},[]),(0,s.useEffect)(()=>(C||P(),()=>{u(),n&&w.current&&(l==null||l.clearWatch(w.current))}),[B]),{getPosition:P,coords:c,timestamp:A,isGeolocationEnabled:H,isGeolocationAvailable:!!l,positionError:O}}Q=z.useGeolocated=re;function de(){const{isGeolocationAvailable:v,isGeolocationEnabled:p,getPosition:x,coords:h,positionError:C,timestamp:n}=Q({positionOptions:{enableHighAccuracy:!0,timeout:1/0,maximumAge:localStorage.getItem("geoMaxAge")||1/0},watchPosition:!0,userDecisionTimeout:5e3});return{isGeolocationAvailable:v,isGeolocationEnabled:p,coords:h,positionError:C,timestamp:n,getPosition:x}}const ce=ie({fullName:d().required("Required"),email:d().email("Invalid email"),wardId:d().required("Required"),address1:d().required("Required"),violationPlace:d().required("Required"),photo:d().required("Required"),challanType:d().required("Required"),mobile:d().min(10).max(10).label("Mobile"),violationId:d().required("Required"),violationDepartmentId:d().required("Required")});function ue(){var A,M,O,L,B,W,u,g,y,P,t,N,k;const v=Y(),p=K.useRef(),[x,h]=S.useState("");S.useState(""),S.useState(""),S.useState("");const{AutoFocusErrorField:C}=oe(),{coords:n,isGeolocationEnabled:l}=de(),b=te({}),f=$({api:E.api_getWardlist,options:{enabled:!0}}),j=$({api:E.api_get_department_list,options:{enabled:!0}}),a=Z({initialValues:{challanType:"",fullName:"",guardianName:"",mobile:"",email:"",holdingNo:"",tradeLicenseNo:"",address1:"",violationPlace:"",witnessName:"",witnessMobileNo:"",city:"",region:"",violationId:"",violationType:"",violationDepartmentId:"",postalCode:"",penaltyAmount:"",wardId:"",photo:"",photo2:"",photo3:"",pdf:"",latitude:"",longitude:"",audioVideo:""},validationSchema:ce,onSubmit:async i=>{await ne("Are you sure you want to generate challan?")?await G(i):T.error("Challan Generation Cancelled")}}),{isSubmitting:I,submitCount:w,errors:H}=a,D=async i=>{var q,F,R,V;if(!l){T.error("Please enable location permission to capture the image with location"),i.target.value=null;return}const _=i.target.files[0];if(_){const o=await se(_),J=new File([o],(F=(q=i==null?void 0:i.target)==null?void 0:q.files[0])==null?void 0:F.name,{type:(V=(R=i==null?void 0:i.target)==null?void 0:R.files[0])==null?void 0:V.type});h(URL.createObjectURL(J)),a.setFieldValue("photo",J),a.setFieldValue("latitude",n==null?void 0:n.latitude),a.setFieldValue("longitude",n==null?void 0:n.longitude)}else a.setFieldValue("photo",null),a.setFieldValue("latitude",""),a.setFieldValue("longitude","")},c=$({api:E.api_department_type_by_department_id,config:{departmentId:a.values.violationDepartmentId},value:[a.values.violationDepartmentId],options:{enabled:!!a.values.violationDepartmentId}}),G=async i=>{var _,q,F,R,V;try{const o=await b.mutateAsync({api:i.challanType=="onSpot"?E.api_save_on_spot:E.api_save_verification,data:i});(_=o==null?void 0:o.data)!=null&&_.status?(T.success((q=o==null?void 0:o.data)==null?void 0:q.message),i.challanType=="onSpot"?(v("/fines-app/today-challan"),a.resetForm()):(v("/fines-app/today-application"),a.resetForm())):T.error((F=o==null?void 0:o.data)==null?void 0:F.message)}catch(o){T.error((V=(R=o==null?void 0:o.response)==null?void 0:R.data)==null?void 0:V.message)}};return S.useEffect(()=>{a.values.challanType&&a.setFieldValue("violationDepartmentId","")},[(A=a==null?void 0:a.values)==null?void 0:A.challanType]),S.useEffect(()=>{C({formik:a})},[H,w,I]),e.jsxs(X,{title:"Generate Challan",meta:e.jsx(e.Fragment,{children:e.jsx("meta",{name:"description",content:"Generate Challan"})}),children:[b.isLoading&&e.jsx(le,{}),e.jsx("div",{className:"p-4",children:e.jsxs(ee,{formik:a,children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-sm font-semibold text-blue-gray-500 mb-2 ",children:"# Violator Information"}),e.jsx(m.Card,{className:"rounded-2xl",children:e.jsx(m.Card.Body,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-1 md:grid-cols-2",children:[e.jsxs(U,{name:"challanType",label:"Challan Type",formik:a,isRequiredLabel:!0,children:[e.jsx("option",{value:"",children:"Select Challan Type"}),e.jsx("option",{value:"onSpot",children:"On Spot"}),e.jsx("option",{value:"verification",children:"Verification"})]}),e.jsx(r,{formik:a,isRequiredLabel:!0,name:"fullName",label:"Full Name",inputValidation:["removeSpecialCharacterWithDoubleSpace","string"]}),e.jsx(r,{formik:a,name:"guardianName",label:"Guardian Name",inputValidation:["removeSpecialCharacterWithDoubleSpace","string","nocopy"]}),e.jsx(r,{formik:a,type:"number",name:"mobile",label:"Mobile No",inputValidation:["mobile"]}),e.jsx(r,{type:"email",formik:a,name:"email",label:"Email"}),e.jsxs(U,{name:"wardId",label:"Ward",formik:a,isRequiredLabel:!0,children:[e.jsx("option",{value:"",children:"Select Ward"}),(O=(M=f.data)==null?void 0:M.data)==null?void 0:O.map(i=>e.jsx("option",{value:i.id,children:i.ward_name},i.id))]}),e.jsx(r,{formik:a,name:"holdingNo",label:"Holding No",inputValidation:["removeSpace"]}),e.jsx(r,{formik:a,name:"tradeLicenseNo",label:"Trade License No",inputValidation:["removeSpace"]})]})})})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h1",{className:"text-sm font-semibold text-blue-gray-500 mb-2 ",children:"# Violator Address Information"}),e.jsx(m.Card,{className:"rounded-2xl",children:e.jsx(m.Card.Body,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-1 md:grid-cols-2",children:[e.jsx(r,{formik:a,name:"region",label:"Region",inputValidation:["removeDoubleSpace"]}),e.jsx(r,{formik:a,name:"address1",isRequiredLabel:!0,label:"Street Address",inputValidation:["removeDoubleSpace"]}),e.jsx(r,{isRequiredLabel:!0,formik:a,name:"violationPlace",label:"Place",inputValidation:["removeDoubleSpace","string"]})]})})})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h1",{className:"text-sm font-semibold text-blue-gray-500 mb-2 ",children:"# Challan Details"}),e.jsx(m.Card,{className:"rounded-2xl",children:e.jsx(m.Card.Body,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-1 md:grid-cols-2",children:[e.jsxs(U,{name:"violationDepartmentId",label:"Violation Department",formik:a,isRequiredLabel:!0,children:[e.jsx("option",{value:"",children:"Select Violation"}),(B=(L=j.data)==null?void 0:L.data)==null?void 0:B.map(i=>e.jsx("option",{value:i.id,children:i.department_name},i.id))]}),e.jsxs(U,{name:"violationId",label:"Violation Type",formik:a,isRequiredLabel:!0,children:[e.jsx("option",{value:"",children:"Select Violation Type"}),((W=a==null?void 0:a.values)==null?void 0:W.challanType)=="onSpot"&&((y=(g=(u=c==null?void 0:c.data)==null?void 0:u.data)==null?void 0:g.filter(i=>i==null?void 0:i.on_spot))==null?void 0:y.map(i=>e.jsx("option",{value:i.id,children:i.violation_name},i.id))),((P=a==null?void 0:a.values)==null?void 0:P.challanType)=="verification"&&((k=(N=(t=c==null?void 0:c.data)==null?void 0:t.data)==null?void 0:N.filter(i=>!(i!=null&&i.on_spot)))==null?void 0:k.map(i=>e.jsx("option",{value:i.id,children:i.violation_name},i.id)))]})]})})})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h1",{className:"text-sm font-semibold text-blue-gray-500 mb-2 ",children:"# Document"}),e.jsx(m.Card,{className:"rounded-2xl",children:e.jsx(m.Card.Body,{children:e.jsx("div",{className:"grid grid-cols-1 gap-1 md:grid-cols-2",children:e.jsxs("div",{children:[e.jsx(r,{isRequiredLabel:!0,accept:"image/*",type:"file",name:"photo",label:"Select Image",onChange:D,ref:p}),a.errors.photo&&a.touched.photo&&e.jsx("span",{className:"text-red-600 text-xs -mt-7",children:a.errors.photo}),e.jsx("div",{className:"mt-4",children:x&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("img",{src:x,alt:"preview",className:"w-40 h-40 object-cover rounded-lg"})}),n&&a.values.photo&&e.jsxs("h1",{className:"text-sm font-semibold text-blue-gray-500 mt-2 ",children:["Latitude: ",a.values.latitude," | Longitude:"," ",a.values.longitude]}),e.jsx("hr",{className:"border-t border-gray-200 my-4"})]})})]})})})})]}),e.jsx("div",{className:"py-8",children:e.jsx(ae,{type:"submit",loading:b.isLoading,disabled:b.isLoading,className:"mt-4",children:"Generate Challan"})})]})})]})}function _e(){return e.jsx(ue,{})}export{_e as default};
