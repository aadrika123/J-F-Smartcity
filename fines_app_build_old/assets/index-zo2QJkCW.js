import{_ as D,c as T,j as e,P as le}from"./index-mo0knpl2.js";import{r as oe,h as re,d as I}from"./router-WshRxXk2.js";import{u as de,F as ce,S as A,T as r,L as ue}from"./TextArea-JAYoRmBO.js";import{r as x}from"./tailwind-Ucrx0-S6.js";import{c as me,a as g}from"./index.esm-Wdru5IDi.js";import{a as pe,b as z}from"./useCustomQuery-uMtzZsfp.js";import{u as he}from"./useErrorFocusField-RmJb-2tU.js";import{r as k}from"./resizeImage-oBsQW1Wn.js";import{C as ge,O as ve}from"./CreateConfirmation-rVq_3uap.js";import"./reactQuery-2daanlHr.js";import"./reactQueryDevtools-6dm9iask.js";import"./axios-YpSsR79r.js";import"./reactIcons-UnuJhE_7.js";import"./reactLazyLoadImageComponent-2lnvQYCj.js";import"./headlessui-oHdMYZDI.js";import"./isObject-p2Uu8wxa.js";var J={};Object.defineProperty(J,"__esModule",{value:!0});var ne=J.useGeolocated=void 0;const l=oe;function xe(N={}){const{positionOptions:f={enableHighAccuracy:!0,maximumAge:0,timeout:1/0},isOptimisticGeolocationEnabled:w=!0,userDecisionTimeout:j=void 0,suppressLocationOnMount:C=!1,watchPosition:b=!1,geolocationProvider:o=typeof navigator<"u"?navigator.geolocation:void 0,watchLocationPermissionChange:O=!1,onError:S,onSuccess:F}=N,R=(0,l.useRef)(0),h=(0,l.useRef)(!0),V=(0,l.useRef)(0),[P,E]=(0,l.useState)(w),[U,t]=(0,l.useState)(),[M,B]=(0,l.useState)(),[W,G]=(0,l.useState)(),[H,$]=(0,l.useState)(),y=(0,l.useCallback)(()=>{R.current&&window.clearTimeout(R.current)},[]),d=(0,l.useCallback)(s=>{y(),h.current&&(t(()=>{}),E(!1),G(s)),S==null||S(s)},[S,y]),_=(0,l.useCallback)(s=>{y(),h.current&&(t(s.coords),B(s.timestamp),E(!0),G(()=>{})),F==null||F(s)},[F,y]),q=(0,l.useCallback)(()=>{if(!o||!o.getCurrentPosition||!o.watchPosition)throw new Error("The provided geolocation provider is invalid");j&&(R.current=window.setTimeout(()=>{d()},j)),b?V.current=o.watchPosition(_,d,f):o.getCurrentPosition(_,d,f)},[o,b,j,d,_,f]);return(0,l.useEffect)(()=>{let s;return O&&o&&"permissions"in navigator&&navigator.permissions.query({name:"geolocation"}).then(L=>{s=L,s.onchange=()=>{$(s.state)}}).catch(L=>{console.error("Error updating the permissions",L)}),()=>{s&&(s.onchange=null)}},[]),(0,l.useEffect)(()=>(C||q(),()=>{y(),b&&V.current&&(o==null||o.clearWatch(V.current))}),[H]),{getPosition:q,coords:U,timestamp:M,isGeolocationEnabled:P,isGeolocationAvailable:!!o,positionError:W}}ne=J.useGeolocated=xe;function fe(){const{isGeolocationAvailable:N,isGeolocationEnabled:f,getPosition:w,coords:j,positionError:C,timestamp:b}=ne({positionOptions:{enableHighAccuracy:!0,timeout:1/0,maximumAge:localStorage.getItem("geoMaxAge")||1/0},watchPosition:!0,userDecisionTimeout:5e3});return{isGeolocationAvailable:N,isGeolocationEnabled:f,coords:j,positionError:C,timestamp:b,getPosition:w}}const je=me({fullName:g().required("Required"),email:g().email("Invalid email"),wardId:g().required("Required"),address1:g().required("Required"),violationPlace:g().required("Required"),photo:g().required("Required"),challanType:g().required("Required"),mobile:g().min(10).max(10).label("Mobile"),violationId:g().required("Required"),violationDepartmentId:g().required("Required")});function be(){var q,s,L,K,Q,X,Y,Z,ee,ae,te,ie,se;const N=re(),f=oe.useRef(),[w,j]=I.useState(""),[C,b]=I.useState(""),[o,O]=I.useState(""),[S,F]=I.useState(""),{AutoFocusErrorField:R}=he(),{coords:h,isGeolocationEnabled:V}=fe(),P=pe({}),E=z({api:T.api_getWardlist,options:{enabled:!0}}),U=z({api:T.api_get_department_list,options:{enabled:!0}}),t=de({initialValues:{challanType:"",fullName:"",guardianName:"",mobile:"",email:"",holdingNo:"",tradeLicenseNo:"",address1:"",violationPlace:"",witnessName:"",witnessMobileNo:"",city:"",region:"",violationId:"",violationType:"",violationDepartmentId:"",postalCode:"",penaltyAmount:"",wardId:"",photo:"",photo2:"",photo3:"",pdf:"",latitude:"",longitude:"",audioVideo:""},validationSchema:je,onSubmit:async a=>{await ge("Are you sure you want to generate challan?")?await _(a):D.error("Challan Generation Cancelled")}}),{isSubmitting:M,submitCount:B,errors:W}=t,G=async a=>{var c,u,m,p;if(!V){D.error("Please enable location permission to capture the image with location"),a.target.value=null;return}const n=a.target.files[0];if(n){const i=await k(n),v=new File([i],(u=(c=a==null?void 0:a.target)==null?void 0:c.files[0])==null?void 0:u.name,{type:(p=(m=a==null?void 0:a.target)==null?void 0:m.files[0])==null?void 0:p.type});j(URL.createObjectURL(v)),t.setFieldValue("photo",v),t.setFieldValue("latitude",h==null?void 0:h.latitude),t.setFieldValue("longitude",h==null?void 0:h.longitude)}else t.setFieldValue("photo",null),t.setFieldValue("latitude",""),t.setFieldValue("longitude","")},H=async a=>{var c,u,m,p;const n=a.target.files[0];if(n){const i=await k(n),v=new File([i],(u=(c=a==null?void 0:a.target)==null?void 0:c.files[0])==null?void 0:u.name,{type:(p=(m=a==null?void 0:a.target)==null?void 0:m.files[0])==null?void 0:p.type});b(URL.createObjectURL(v)),t.setFieldValue("photo2",v)}else t.setFieldValue("photo2",null)},$=async a=>{var c,u,m,p;const n=a.target.files[0];if(n){const i=await k(n),v=new File([i],(u=(c=a==null?void 0:a.target)==null?void 0:c.files[0])==null?void 0:u.name,{type:(p=(m=a==null?void 0:a.target)==null?void 0:m.files[0])==null?void 0:p.type});O(URL.createObjectURL(v)),t.setFieldValue("photo3",v)}else t.setFieldValue("photo3",null)},y=async a=>{const n=a.target.files[0];t.setFieldValue("pdf",n),F(URL.createObjectURL(n))},d=z({api:T.api_department_type_by_department_id,config:{departmentId:t.values.violationDepartmentId},value:[t.values.violationDepartmentId],options:{enabled:!!t.values.violationDepartmentId}}),_=async a=>{var n,c,u,m,p;try{const i=await P.mutateAsync({api:a.challanType=="onSpot"?T.api_save_on_spot:T.api_save_verification,data:a});(n=i==null?void 0:i.data)!=null&&n.status?(D.success((c=i==null?void 0:i.data)==null?void 0:c.message),a.challanType=="onSpot"?(N("/fines-app/today-challan"),t.resetForm()):(N("/fines-app/today-application"),t.resetForm())):D.error((u=i==null?void 0:i.data)==null?void 0:u.message)}catch(i){D.error((p=(m=i==null?void 0:i.response)==null?void 0:m.data)==null?void 0:p.message)}};return I.useEffect(()=>{t.values.challanType&&t.setFieldValue("violationDepartmentId","")},[(q=t==null?void 0:t.values)==null?void 0:q.challanType]),I.useEffect(()=>{R({formik:t})},[W,B,M]),e.jsxs(le,{title:"Generate Challan",meta:e.jsx(e.Fragment,{children:e.jsx("meta",{name:"description",content:"Generate Challan"})}),children:[P.isLoading&&e.jsx(ve,{}),e.jsx("div",{className:"p-4",children:e.jsxs(ce,{formik:t,children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-sm font-semibold text-blue-gray-500 mb-2 ",children:"# Violator Information"}),e.jsx(x.Card,{className:"rounded-2xl",children:e.jsx(x.Card.Body,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-1 md:grid-cols-2",children:[e.jsxs(A,{name:"challanType",label:"Challan Type",formik:t,isRequiredLabel:!0,children:[e.jsx("option",{value:"",children:"Select Challan Type"}),e.jsx("option",{value:"onSpot",children:"On Spot"}),e.jsx("option",{value:"verification",children:"Verification"})]}),e.jsx(r,{formik:t,isRequiredLabel:!0,name:"fullName",label:"Full Name",inputValidation:["removeSpecialCharacterWithDoubleSpace","string"]}),e.jsx(r,{formik:t,name:"guardianName",label:"Guardian Name",inputValidation:["removeSpecialCharacterWithDoubleSpace","string","nocopy"]}),e.jsx(r,{formik:t,type:"number",name:"mobile",label:"Mobile No",inputValidation:["mobile"]}),e.jsx(r,{type:"email",formik:t,name:"email",label:"Email"}),e.jsxs(A,{name:"wardId",label:"Ward",formik:t,isRequiredLabel:!0,children:[e.jsx("option",{value:"",children:"Select Ward"}),(L=(s=E.data)==null?void 0:s.data)==null?void 0:L.map(a=>e.jsx("option",{value:a.id,children:a.ward_name},a.id))]}),e.jsx(r,{formik:t,name:"holdingNo",label:"Holding No",inputValidation:["removeSpace"]}),e.jsx(r,{formik:t,name:"tradeLicenseNo",label:"Trade License No",inputValidation:["removeSpace"]})]})})})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h1",{className:"text-sm font-semibold text-blue-gray-500 mb-2 ",children:"# Violator Address Information"}),e.jsx(x.Card,{className:"rounded-2xl",children:e.jsx(x.Card.Body,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-1 md:grid-cols-2",children:[e.jsx(r,{formik:t,name:"region",label:"Region",inputValidation:["removeDoubleSpace"]}),e.jsx(r,{formik:t,name:"address1",isRequiredLabel:!0,label:"Street Address",inputValidation:["removeDoubleSpace"]}),e.jsx(r,{isRequiredLabel:!0,formik:t,name:"violationPlace",label:"Place",inputValidation:["removeDoubleSpace","string"]})]})})})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h1",{className:"text-sm font-semibold text-blue-gray-500 mb-2 ",children:"# Challan Details"}),e.jsx(x.Card,{className:"rounded-2xl",children:e.jsx(x.Card.Body,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-1 md:grid-cols-2",children:[e.jsxs(A,{name:"violationDepartmentId",label:"Violation Department",formik:t,isRequiredLabel:!0,children:[e.jsx("option",{value:"",children:"Select Violation"}),(Q=(K=U.data)==null?void 0:K.data)==null?void 0:Q.map(a=>e.jsx("option",{value:a.id,children:a.department_name},a.id))]}),e.jsxs(A,{name:"violationId",label:"Violation Type",formik:t,isRequiredLabel:!0,children:[e.jsx("option",{value:"",children:"Select Violation Type"}),((X=t==null?void 0:t.values)==null?void 0:X.challanType)=="onSpot"&&((ee=(Z=(Y=d==null?void 0:d.data)==null?void 0:Y.data)==null?void 0:Z.filter(a=>a==null?void 0:a.on_spot))==null?void 0:ee.map(a=>e.jsx("option",{value:a.id,children:a.violation_name},a.id))),((ae=t==null?void 0:t.values)==null?void 0:ae.challanType)=="verification"&&((se=(ie=(te=d==null?void 0:d.data)==null?void 0:te.data)==null?void 0:ie.filter(a=>!(a!=null&&a.on_spot)))==null?void 0:se.map(a=>e.jsx("option",{value:a.id,children:a.violation_name},a.id)))]})]})})})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h1",{className:"text-sm font-semibold text-blue-gray-500 mb-2 ",children:"# Document"}),e.jsx(x.Card,{className:"rounded-2xl",children:e.jsx(x.Card.Body,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-1 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(r,{isRequiredLabel:!0,accept:"image/*",type:"file",name:"photo",label:"Select Image",onChange:G,ref:f}),t.errors.photo&&t.touched.photo&&e.jsx("span",{className:"text-red-600 text-xs -mt-7",children:t.errors.photo}),e.jsx("div",{className:"mt-4",children:w&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("img",{src:w,alt:"preview",className:"w-40 h-40 object-cover rounded-lg"})}),h&&t.values.photo&&e.jsxs("h1",{className:"text-sm font-semibold text-blue-gray-500 mt-2 ",children:["Latitude: ",t.values.latitude," | Longitude:"," ",t.values.longitude]}),e.jsx("hr",{className:"border-t border-gray-200 my-4"})]})})]}),e.jsxs("div",{children:[e.jsx(r,{accept:"image/*",type:"file",name:"photo2",label:"Select Image 2",onChange:H}),e.jsx("div",{className:"mt-4",children:C&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("img",{src:C,alt:"preview",className:"w-40 h-40 object-cover rounded-lg"})}),e.jsx("hr",{className:"border-t border-gray-200 my-4"})]})})]}),e.jsxs("div",{children:[e.jsx(r,{accept:"image/*",type:"file",name:"photo3",label:"Select Image 3",onChange:$}),e.jsx("div",{className:"mt-4",children:o&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("img",{src:o,alt:"preview",className:"w-40 h-40 object-cover rounded-lg"})}),e.jsx("hr",{className:"border-t border-gray-200 my-4"})]})})]}),e.jsxs("div",{children:[e.jsx(r,{accept:".pdf",type:"file",name:"pdf",label:"Select PDF",onChange:y}),e.jsx("div",{className:"mt-4",children:t.values.pdf&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("iframe",{src:S,width:"100%",height:"250px",children:"This browser does not support PDFs. Please download the PDF to view it: Download PDF"})}),e.jsx("hr",{className:"border-t border-gray-200 my-4"})]})})]})]})})})]}),e.jsx("div",{className:"py-8",children:e.jsx(ue,{type:"submit",loading:P.isLoading,disabled:P.isLoading,className:"mt-4",children:"Generate Challan"})})]})})]})}function Ge(){return e.jsx(be,{})}export{Ge as default};
